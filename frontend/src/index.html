<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mediaschool Portal</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Le CSS reste le même que la version "Dark Matter" */
        :root {
            --bg-dark: #0d0f1a;
            --surface-dark: #171923;
            --primary-accent: #6366f1;
            --primary-accent-hover: #4f46e5;
            --text-primary: #e2e8f0;
            --text-secondary: #94a3b8;
            --border-color: rgba(255, 255, 255, 0.1);
            --success-color: #34d399;
            --error-color: #f87171;
            color-scheme: dark;
        }
        *, *::before, *::after { box-sizing: border-box; }
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            background-color: var(--bg-dark);
            color: var(--text-primary);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        #particles-js { position: fixed; width: 100%; height: 100%; top: 0; left: 0; z-index: -1; }
        .container { max-width: 1100px; margin: 0 auto; padding: 80px 24px; position: relative; z-index: 1; }
        header { text-align: center; margin-bottom: 64px; }
        header h1 { font-size: 3rem; font-weight: 700; letter-spacing: -0.05em; margin: 0; background: linear-gradient(90deg, #a5b4fc, #6366f1); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        header p { font-size: 1.125rem; color: var(--text-secondary); max-width: 600px; margin: 8px auto 0; }
        .main-grid { display: grid; grid-template-columns: 1fr; gap: 24px; }
        @media (min-width: 768px) { .main-grid { grid-template-columns: repeat(2, 1fr); } }
        .card { background: rgba(23, 25, 35, 0.7); border: 1px solid var(--border-color); border-radius: 12px; padding: 24px; backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); transition: transform 0.3s ease, background 0.3s ease; }
        .card:hover { transform: translateY(-5px); background: rgba(23, 25, 35, 1); }
        #stats-card { grid-column: 1 / -1; }
        .card-header { display: flex; align-items: center; gap: 16px; margin-bottom: 20px; }
        .card-header .icon { flex-shrink: 0; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 8px; background-color: var(--primary-accent); color: white; box-shadow: 0 0 15px rgba(99, 102, 241, 0.5); }
        .card-header h2 { font-size: 1.25rem; font-weight: 600; margin: 0; }
        button { font-family: inherit; font-size: 0.875rem; font-weight: 500; padding: 10px 16px; cursor: pointer; border: 1px solid var(--primary-accent); border-radius: 8px; background-color: transparent; color: var(--primary-accent); transition: background-color 0.2s ease, color 0.2s ease; }
        button:hover { background-color: var(--primary-accent); color: white; }
        .response-box { margin-top: 16px; padding: 12px; border-radius: 6px; background-color: var(--bg-dark); font-family: monospace; font-size: 0.875rem; color: var(--text-secondary); }
        .response-box.success { color: var(--success-color); }
        .response-box.error { color: var(--error-color); }
        #stats-grid pre { background-color: var(--bg-dark); padding: 16px; border-radius: 8px; font-size: 0.9rem; color: var(--text-primary); white-space: pre-wrap; word-break: break-all; }
        .loader { width: 24px; height: 24px; border: 3px solid var(--border-color); border-top-color: var(--primary-accent); border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div id="particles-js"></div>
    <div class="container">
        <header>
            <h1>Mediaschool Portal</h1>
            <p>Tableau de bord pour le monitoring de la stack applicative.</p>
        </header>
        <main class="main-grid">
            <div class="card">
                <div class="card-header"><div class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.54 15H17l-2 6-4-12-2 6H2.46"></path></svg></div><h2>API Status</h2></div>
                <button onclick="pingBackend()">Lancer le Ping</button>
                <div id="response" class="response-box">En attente de commande...</div>
            </div>
            <div class="card">
                <div class="card-header"><div class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 4v16"></path><path d="M8 8H4a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h4"></path><path d="M16 16h4a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2h-4"></path></svg></div><h2>Database</h2></div>
                <button onclick="window.open('http://localhost:8080', '_blank')">Ouvrir phpMyAdmin</button>
            </div>
            <div id="stats-card" class="card">
                <div class="card-header"><div class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7.5 4.5v15"></path><path d="M12 4.5v15"></path><path d="M4.5 4.5v15"></path><path d="M16.5 4.5l3 3"></path><path d="M16.5 10.5l3 3"></path><path d="M16.5 16.5l3 3"></path></svg></div><h2>Monitoring Backend</h2></div>
                <div id="stats-grid"><div class="loader"></div></div>
            </div>
        </main>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/tsparticles@2/tsparticles.bundle.min.js"></script>
    <script>
        tsParticles.load("particles-js", {
            fpsLimit: 60,
            particles: { number: { value: 60, density: { enable: true, value_area: 800 } }, color: { value: "#ffffff" }, shape: { type: "circle" }, opacity: { value: 0.3, random: true, anim: { enable: true, speed: 0.5, opacity_min: 0.1, sync: false } }, size: { value: 2, random: true }, links: { enable: true, distance: 150, color: "#ffffff", opacity: 0.1, width: 1 }, move: { enable: true, speed: 0.5, direction: "none", random: true, straight: false, out_mode: "out" } },
            interactivity: { detect_on: "canvas", events: { onhover: { enable: true, mode: "grab" }, onclick: { enable: false } }, modes: { grab: { distance: 140, line_opacity: 0.3 } } },
            retina_detect: true,
        });
    
        function updateResponse(elementId, message, isSuccess = null) {
            const el = document.getElementById(elementId);
            el.textContent = message;
            el.className = 'response-box';
            if (isSuccess === true) el.classList.add('success');
            if (isSuccess === false) el.classList.add('error');
        }

        async function pingBackend() {
            updateResponse('response', 'Ping en cours...');
            try {
                const response = await fetch('/index.php');
                if (!response.ok) throw new Error(`Erreur HTTP: ${response.status}`);
                const data = await response.text();
                updateResponse('response', `Réponse : "${data}"`, true);
            } catch (error) {
                updateResponse('response', `Échec : ${error.message}`, false);
            }
        }

        async function fetchStats() {
            const grid = document.getElementById('stats-grid');
            try {
                const response = await fetch('/stats.php');
                if (!response.ok) throw new Error(`Erreur HTTP: ${response.status}`);
                const stats = await response.json();
                
                // On utilise padEnd pour aligner joliment les valeurs
                const statsText = 
`Container        : ${stats.Name}
Processes        : ${stats.Processes}

[Memory]
Usage            : ${stats.Memory_Usage_MB} MB (Limit: ${stats.Memory_Limit_MB})
  - App          : ${stats.Memory_Detail_MB.Application} MB
  - Cache        : ${stats.Memory_Detail_MB.FileCache} MB

[CPU Time]
Total            : ${stats.CPU_Total_ms.toLocaleString('fr-FR')} ms
  - User         : ${stats.CPU_Detail_ms.User.toLocaleString('fr-FR')} ms
  - System       : ${stats.CPU_Detail_ms.System.toLocaleString('fr-FR')} ms

[Disk I/O]
Read             : ${stats.IO_MB.Read} MB
Write            : ${stats.IO_MB.Write} MB`;

                grid.innerHTML = `<pre>${statsText}</pre>`;
            } catch (error) {
                grid.innerHTML = `<div class="response-box error">Impossible de charger les stats : ${error.message}</div>`;
            }
        }

        window.addEventListener('DOMContentLoaded', () => {
            fetchStats();
            setInterval(fetchStats, 100);
        });
    </script>
</body>
</html>