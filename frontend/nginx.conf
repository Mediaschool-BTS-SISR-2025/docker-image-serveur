server {
    listen 80;
    server_name localhost;

    # Racine où se trouvent tes fichiers (HTML, JS, CSS)
    root /usr/share/nginx/html;
    index index.html index.htm;

    # --- PARTIE 1 : Servir le Frontend (React, Vue, HTML...) ---
    
    # Gère les fichiers statiques
    location / {
        try_files $uri $uri/ /index.html; # Important pour les Single Page Apps (React/Vue)
    }

    # --- PARTIE 2 : Gérer l'API Backend ---
    
    # Toutes les requêtes qui commencent par /api/ 
    # (ou ce que tu veux, ex: ~.php$)
    location ~ ^/(api|index)\.php(/|$) {
        
        # C'est ici la magie :
        # On transmet la requête au service 'backend' sur le port 9000
        # en utilisant le protocole FastCGI
        fastcgi_pass   backend:9000;
        
        fastcgi_split_path_info ^(.+\.php)(/.+)$;
        include        fastcgi_params;
        fastcgi_param  SCRIPT_FILENAME  /var/www/html/$fastcgi_script_name;
        fastcgi_param  PATH_INFO        $fastcgi_path_info;
    }
}